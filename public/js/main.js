'use strict';

var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var map;
function initialize() {
  var mapCanvas = document.getElementById('map-canvas'); //div in the html
  var mapOptions = {
    center: new google.maps.LatLng(36.1667, 86.7833), //NashVegas, TN
    zoom: 15,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    scrollwheel: false };
  map = new google.maps.Map(mapCanvas, mapOptions);
  console.log(map); //this works, produces map object
  // Try HTML5 geolocation
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (position) {
      var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
        pixelOffset: new google.maps.Size(0, -20),
        content: 'Start here'
      });
      var marker = new google.maps.Marker({
        position: pos,
        map: map,
        animation: google.maps.Animation.DROP,
        title: 'This marks geolocation'
      });
      //copied the next six lines from google
      google.maps.event.addListener(marker, 'click', toggleBounce);
      function toggleBounce() {
        if (marker.getAnimation() !== null) {
          marker.setAnimation(null);
        } else {
          marker.setAnimation(google.maps.Animation.BOUNCE);
        }
      }
      google.maps.event.addListener(marker, 'click', function () {
        infowindow.open(map, marker); //this should be redone in the infobox class
      });
      map.setCenter(pos);
      //refactored code from weather app
      var btnWhereTo = document.querySelector('#btnWhereTo'); //creates the button element using the id from the button input
      btnWhereTo.onclick = function () {
        calcRoute();
      };
      //adds the calcroute within geolocation because geolocation is the starting point
    }, function () {
      handleNoGeolocation(true);
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
}
function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Aw snap! Something went wrong with the Geolocation service. Sorry?';
  } else {
    var content = 'Aw, snap! Your browser doesn\'t support geolocation.';
  }
  var options = {
    map: map,
    position: new google.maps.LatLng(36.1667, 86.7833),
    content: content
  };
  var infowindow = new google.maps.InfoWindow(options);
  map.setCenter(options.position);
}
//autocomplete for the search box
var pac_input = document.getElementById('whereTo');
(function pacSelectFirst(input) {
  // store the original event binding function
  var _addEventListener = input.addEventListener ? input.addEventListener : input.attachEvent;
  function addEventListenerWrapper(type, listener) {
    // Simulate a 'down arrow' keypress on hitting 'return' when no pac suggestion is selected,
    // and then trigger the original listener.
    if (type == 'keydown') {
      var orig_listener = listener;
      listener = function (event) {
        var suggestion_selected = $('.pac-item-selected').length > 0;
        if (event.which == 13 && !suggestion_selected) {
          var simulated_downarrow = $.Event('keydown', {
            keyCode: 40,
            which: 40
          });
          orig_listener.apply(input, [simulated_downarrow]);
        }
        orig_listener.apply(input, [event]);
      };
    }
    // add the modified listener
    _addEventListener.apply(input, [type, listener]);
  }
  if (input.addEventListener) input.addEventListener = addEventListenerWrapper;else if (input.attachEvent) input.attachEvent = addEventListenerWrapper;
})(pac_input);
$(function () {
  var autocomplete = new google.maps.places.Autocomplete(pac_input);
});
//draws the directions on the page
function calcRoute() {
  var input = document.querySelector('#whereTo');
  var whereTo = input.value;
  var hooters2ndAve = new google.maps.LatLng(36.1646, -86.7766);
  var waypts = [{
    location: hooters2ndAve,
    stopover: true
  }];
  /*  function addHooters () {
      var hooters2ndAve = new google.maps.LatLng(36.1646,-86.7766);
    waypoints.push();*/
  directionsDisplay = new google.maps.DirectionsRenderer();
  directionsDisplay.setMap(map);
  navigator.geolocation.getCurrentPosition(function (position) {
    var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
    var request = {
      origin: pos, //from geolocation
      destination: whereTo, //from input.value of #whereTo
      waypoints: waypts,
      optimizeWaypoints: false,
      travelMode: google.maps.TravelMode.DRIVING
    };
    // console.log(waypts);
    console.log(pos);
    console.log(whereTo);
    directionsService.route(request, function (response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
      }
    });
  });
};
google.maps.event.addDomListener(window, 'load', initialize, calcRoute);
//# sourceMappingURL=data:application/json;base64,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ciBkaXJlY3Rpb25zRGlzcGxheTtcbnZhciBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZSgpO1xudmFyIG1hcDtcbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gIHZhciBtYXBDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNhbnZhcycpOyAvL2RpdiBpbiB0aGUgaHRtbFxuICB2YXIgbWFwT3B0aW9ucyA9IHtcbiAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoMzYuMTY2NywgODYuNzgzMyksIC8vTmFzaFZlZ2FzLCBUTlxuICAgIHpvb206IDE1LFxuICAgIG1hcFR5cGVJZDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVAsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlLFxuICB9XG4gIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAobWFwQ2FudmFzLCBtYXBPcHRpb25zKTtcbiAgY29uc29sZS5sb2cobWFwKTsgLy90aGlzIHdvcmtzLCBwcm9kdWNlcyBtYXAgb2JqZWN0XG4gIC8vIFRyeSBIVE1MNSBnZW9sb2NhdGlvblxuICBpZiAobmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XG4gICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgIHZhciBwb3MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSwgcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSk7XG4gICAgICB2YXIgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHtcbiAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgIHBvc2l0aW9uOiBwb3MsXG4gICAgICAgIHBpeGVsT2Zmc2V0OiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgwLCAtMjApLFxuICAgICAgICBjb250ZW50OiAnU3RhcnQgaGVyZSdcbiAgICAgIH0pO1xuICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICBwb3NpdGlvbjogcG9zLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcbiAgICAgICAgdGl0bGU6ICdUaGlzIG1hcmtzIGdlb2xvY2F0aW9uJ1xuICAgICAgfSk7XG4gICAgICAvL2NvcGllZCB0aGUgbmV4dCBzaXggbGluZXMgZnJvbSBnb29nbGVcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgdG9nZ2xlQm91bmNlKTtcbiAgICAgIGZ1bmN0aW9uIHRvZ2dsZUJvdW5jZSgpIHtcbiAgICAgICAgaWYgKG1hcmtlci5nZXRBbmltYXRpb24oKSAhPT0gbnVsbCkge1xuICAgICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24obnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFya2VyLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGluZm93aW5kb3cub3BlbihtYXAsIG1hcmtlcik7IC8vdGhpcyBzaG91bGQgYmUgcmVkb25lIGluIHRoZSBpbmZvYm94IGNsYXNzXG4gICAgICB9KTtcbiAgICAgIG1hcC5zZXRDZW50ZXIocG9zKTtcbiAgICAgIC8vcmVmYWN0b3JlZCBjb2RlIGZyb20gd2VhdGhlciBhcHBcbiAgICAgIHZhciBidG5XaGVyZVRvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J0bldoZXJlVG8nKTsgLy9jcmVhdGVzIHRoZSBidXR0b24gZWxlbWVudCB1c2luZyB0aGUgaWQgZnJvbSB0aGUgYnV0dG9uIGlucHV0XG4gICAgICBidG5XaGVyZVRvLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhbGNSb3V0ZSgpO1xuICAgICAgfTtcbiAgICAgIC8vYWRkcyB0aGUgY2FsY3JvdXRlIHdpdGhpbiBnZW9sb2NhdGlvbiBiZWNhdXNlIGdlb2xvY2F0aW9uIGlzIHRoZSBzdGFydGluZyBwb2ludFxuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIGhhbmRsZU5vR2VvbG9jYXRpb24odHJ1ZSk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgLy8gQnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgR2VvbG9jYXRpb25cbiAgICBoYW5kbGVOb0dlb2xvY2F0aW9uKGZhbHNlKTtcbiAgfVxufVxuZnVuY3Rpb24gaGFuZGxlTm9HZW9sb2NhdGlvbihlcnJvckZsYWcpIHtcbiAgaWYgKGVycm9yRmxhZykge1xuICAgIHZhciBjb250ZW50ID0gJ0F3IHNuYXAhIFNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggdGhlIEdlb2xvY2F0aW9uIHNlcnZpY2UuIFNvcnJ5Pyc7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGNvbnRlbnQgPSAnQXcsIHNuYXAhIFlvdXIgYnJvd3NlciBkb2VzblxcJ3Qgc3VwcG9ydCBnZW9sb2NhdGlvbi4nO1xuICB9XG4gIHZhciBvcHRpb25zID0ge1xuICAgIG1hcDogbWFwLFxuICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDM2LjE2NjcsIDg2Ljc4MzMpLFxuICAgIGNvbnRlbnQ6IGNvbnRlbnRcbiAgfTtcbiAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyhvcHRpb25zKTtcbiAgbWFwLnNldENlbnRlcihvcHRpb25zLnBvc2l0aW9uKTtcbn1cbi8vYXV0b2NvbXBsZXRlIGZvciB0aGUgc2VhcmNoIGJveFxudmFyIHBhY19pbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aGVyZVRvJyk7XG4oZnVuY3Rpb24gcGFjU2VsZWN0Rmlyc3QoaW5wdXQpIHtcbiAgLy8gc3RvcmUgdGhlIG9yaWdpbmFsIGV2ZW50IGJpbmRpbmcgZnVuY3Rpb25cbiAgdmFyIF9hZGRFdmVudExpc3RlbmVyID0gKGlucHV0LmFkZEV2ZW50TGlzdGVuZXIpID8gaW5wdXQuYWRkRXZlbnRMaXN0ZW5lciA6IGlucHV0LmF0dGFjaEV2ZW50O1xuICBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyV3JhcHBlcih0eXBlLCBsaXN0ZW5lcikge1xuICAgIC8vIFNpbXVsYXRlIGEgJ2Rvd24gYXJyb3cnIGtleXByZXNzIG9uIGhpdHRpbmcgJ3JldHVybicgd2hlbiBubyBwYWMgc3VnZ2VzdGlvbiBpcyBzZWxlY3RlZCxcbiAgICAvLyBhbmQgdGhlbiB0cmlnZ2VyIHRoZSBvcmlnaW5hbCBsaXN0ZW5lci5cbiAgICBpZiAodHlwZSA9PSBcImtleWRvd25cIikge1xuICAgICAgdmFyIG9yaWdfbGlzdGVuZXIgPSBsaXN0ZW5lcjtcbiAgICAgIGxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBzdWdnZXN0aW9uX3NlbGVjdGVkID0gJChcIi5wYWMtaXRlbS1zZWxlY3RlZFwiKS5sZW5ndGggPiAwO1xuICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT0gMTMgJiYgIXN1Z2dlc3Rpb25fc2VsZWN0ZWQpIHtcbiAgICAgICAgICB2YXIgc2ltdWxhdGVkX2Rvd25hcnJvdyA9ICQuRXZlbnQoXCJrZXlkb3duXCIsIHtcbiAgICAgICAgICAgIGtleUNvZGU6IDQwLFxuICAgICAgICAgICAgd2hpY2g6IDQwXG4gICAgICAgICAgfSlcbiAgICAgICAgICBvcmlnX2xpc3RlbmVyLmFwcGx5KGlucHV0LCBbc2ltdWxhdGVkX2Rvd25hcnJvd10pO1xuICAgICAgICB9XG4gICAgICAgIG9yaWdfbGlzdGVuZXIuYXBwbHkoaW5wdXQsIFtldmVudF0pO1xuICAgICAgfTtcbiAgICB9XG4gICAgLy8gYWRkIHRoZSBtb2RpZmllZCBsaXN0ZW5lclxuICAgIF9hZGRFdmVudExpc3RlbmVyLmFwcGx5KGlucHV0LCBbdHlwZSwgbGlzdGVuZXJdKTtcbiAgfVxuICBpZiAoaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcilcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyID0gYWRkRXZlbnRMaXN0ZW5lcldyYXBwZXI7XG4gIGVsc2UgaWYgKGlucHV0LmF0dGFjaEV2ZW50KVxuICAgIGlucHV0LmF0dGFjaEV2ZW50ID0gYWRkRXZlbnRMaXN0ZW5lcldyYXBwZXI7XG59KShwYWNfaW5wdXQpO1xuJChmdW5jdGlvbiAoKSB7XG4gIHZhciBhdXRvY29tcGxldGUgPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShwYWNfaW5wdXQpO1xufSk7XG4vL2RyYXdzIHRoZSBkaXJlY3Rpb25zIG9uIHRoZSBwYWdlXG5mdW5jdGlvbiBjYWxjUm91dGUoKSB7XG4gIHZhciBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3aGVyZVRvJyk7XG4gIHZhciB3aGVyZVRvID0gaW5wdXQudmFsdWU7XG52YXIgaG9vdGVyczJuZEF2ZSA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoMzYuMTY0NiwgLTg2Ljc3NjYpO1xuICB2YXIgd2F5cHRzID0gW3tcbiAgICBsb2NhdGlvbjogaG9vdGVyczJuZEF2ZSxcbiAgICBzdG9wb3ZlcjogdHJ1ZVxuICB9XTtcbiAgLyogIGZ1bmN0aW9uIGFkZEhvb3RlcnMgKCkge1xuICAgICAgdmFyIGhvb3RlcnMybmRBdmUgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDM2LjE2NDYsLTg2Ljc3NjYpO1xuICAgIHdheXBvaW50cy5wdXNoKCk7Ki9cbiAgZGlyZWN0aW9uc0Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKCk7XG4gIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcChtYXApO1xuICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xuICAgIHZhciBwb3MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSwgcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSk7XG4gICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICBvcmlnaW46IHBvcywgLy9mcm9tIGdlb2xvY2F0aW9uXG4gICAgICBkZXN0aW5hdGlvbjogd2hlcmVUbywgLy9mcm9tIGlucHV0LnZhbHVlIG9mICN3aGVyZVRvXG4gICAgICB3YXlwb2ludHM6IHdheXB0cyxcbiAgICAgIG9wdGltaXplV2F5cG9pbnRzOiBmYWxzZSxcbiAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLlRyYXZlbE1vZGUuRFJJVklOR1xuICAgIH07XG4gICAvLyBjb25zb2xlLmxvZyh3YXlwdHMpO1xuICAgIGNvbnNvbGUubG9nKHBvcyk7XG4gICAgY29uc29sZS5sb2cod2hlcmVUbyk7XG4gICAgZGlyZWN0aW9uc1NlcnZpY2Uucm91dGUocmVxdWVzdCwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcbiAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1N0YXR1cy5PSykge1xuICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59O1xuZ29vZ2xlLm1hcHMuZXZlbnQuYWRkRG9tTGlzdGVuZXIod2luZG93LCAnbG9hZCcsIGluaXRpYWxpemUsIGNhbGNSb3V0ZSk7XG4iXX0=